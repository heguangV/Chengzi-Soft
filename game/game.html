<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>心形点击游戏</title>
    <style>
        /* 游戏基础样式 */
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            text-align: center;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
            overflow: hidden;
        }

        .game-container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            padding: 0;
        }

        /* 游戏区域样式 */
        .game-board {
            position: relative;
            margin-bottom: 0;
            background-color: #ffebee;
            border-radius: 10px;
            min-height: 500px;
            overflow: hidden;
            cursor: pointer;
            padding-top: 70px;
        }

        /* 游戏信息区域样式 - 放置在粉色区域内部 */
        .game-info {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            justify-content: space-around;
            width: 90%;
            max-width: 600px;
            font-size: 1.2em;
            font-weight: bold;
            z-index: 10;
        }

        .score, .time, .target {
            padding: 10px 20px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* 心形目标样式 */
        .heart {
            position: absolute;
            width: 50px;
            height: 50px;
            background-image: url('../0x300a0a0.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            cursor: pointer;
            opacity: 0;
            transition: all 0.3s ease;
            animation: fadeIn 0.3s forwards;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        /* 增强的点击反馈效果 */
        .heart.hit {
            transform: scale(1.2);
            box-shadow: 0 0 15px rgba(255, 71, 87, 0.7);
        }

        /* 加分提示样式 */
        .score-popup {
            position: absolute;
            color: #ff4757;
            font-size: 20px;
            font-weight: bold;
            pointer-events: none;
            animation: scorePopup 1s forwards;
            z-index: 20;
        }

        @keyframes scorePopup {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-30px);
            }
        }

        /* 倒计时样式 */
        .countdown {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px;
            font-weight: bold;
            color: #ff4757;
            z-index: 30;
        }

        /* 按钮样式 */
        .button {
            padding: 10px 20px;
            font-size: 1.1em;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin: 5px;
        }

        /* 暂停按钮样式 - 修改为||图形 */
        .button.pause {
            background-color: #f44336;
            width: 40px;
            padding: 10px 5px;
            position: relative;
            font-size: 0; /* 隐藏文字 */
        }
        
        .button.pause:hover {
            background-color: #d32f2f;
        }
        
        .button.pause::before, .button.pause::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 20px;
            background-color: white;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .button.pause::before {
            left: 12px;
        }
        
        .button.pause::after {
            right: 12px;
        }
        
        /* 开始按钮容器样式 */
        .start-button-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .start-button-container .button {
            padding: 15px 40px;
            font-size: 1.5em;
        }
        
        /* 游戏控制区域样式 - 调整位置到游戏信息区域旁边 */
        .game-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 20;
        }

        /* 暂停菜单样式 */
        .pause-menu {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 235, 238, 0.9);
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 40;
        }

        .pause-menu.active {
            display: flex;
        }

        .pause-menu h2 {
            color: #333;
            margin-bottom: 30px;
            font-size: 2em;
        }

        .pause-menu .button {
            margin: 10px;
            min-width: 150px;
        }

        .button:hover {
            background-color: #45a049;
        }

        .button:active {
            transform: scale(0.98);
        }

        .button.restart {
            background-color: #ff9800;
        }

        .button.restart:hover {
            background-color: #e68a00;
        }

        /* 游戏结束弹窗样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            width: 90%;
            max-width: 400px;
        }

        .modal h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .modal p {
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        /* 响应式设计 */
        @media (max-width: 600px) {
            .game-board {
                min-height: 300px;
            }

            .game-info {
                flex-direction: column;
                gap: 10px;
            }

            .score, .time, .target {
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        
        <div class="game-info">
            <div class="score">得分: <span id="score">0</span></div>
            <div class="time">时间: <span id="time">30</span>秒</div>
            <div class="target">目标: <span id="target-score">20</span>分</div>
        </div>
        
        <div class="game-board" id="game-board">
            <!-- 心形目标将通过JavaScript动态生成 -->
            <div class="start-button-container" id="start-button-container">
                <button class="button" id="start-button">开始游戏</button>
            </div>
            
            <!-- 暂停菜单 -->
            <div class="pause-menu" id="pause-menu">
                <h2>游戏暂停</h2>
                <div>
                    <button class="button" id="resume-button">继续游戏</button>
                    <button class="button restart" id="pause-restart-button">重新开始</button>
                </div>
            </div>
        </div>
        
        <!-- 游戏控制区域 - 仅在游戏运行时显示 -->
        <div class="game-controls" id="game-controls" style="display: none;">
            <button class="button pause" id="pause-button">暂停游戏</button>
        </div>
    </div>

    <!-- 游戏结束弹窗 -->
    <div class="modal" id="game-over-modal">
        <div class="modal-content">
            <h2 id="modal-title">游戏结束</h2>
            <p>你的得分: <span id="final-score">0</span></p>
            <p id="result-message"></p>
            <button class="button restart" id="play-again-button">再玩一次</button>
        </div>
    </div>

    <script>
        // 游戏常量
        const GAME_TIME = 30; // 游戏时间(秒)
        const TARGET_SCORE = 20; // 目标分数
        const MIN_TARGET_TIME = 1000; // 目标最小出现时间(毫秒)
        const MAX_TARGET_TIME = 2000; // 目标最大出现时间(毫秒)
        const MIN_INTERVAL = 1000; // 目标出现的最小间隔(毫秒) - 增加以降低生成频率
        const MAX_INTERVAL = 2000; // 目标出现的最大间隔(毫秒) - 增加以降低生成频率
        const MAX_ACTIVE_TARGETS = 5; // 最大同时活跃目标数量
        const MIN_TARGET_SIZE = 30; // 最小目标尺寸
        const MAX_TARGET_SIZE = 60; // 最大目标尺寸
        const COUNTDOWN_TIME = 3; // 倒计时时间(秒)

        // 获取DOM元素
        const gameBoard = document.getElementById('game-board');
        const startButton = document.getElementById('start-button');
        const restartButton = document.getElementById('restart-button'); // 可能不再需要
        const pauseButton = document.getElementById('pause-button');
        const resumeButton = document.getElementById('resume-button');
        const pauseRestartButton = document.getElementById('pause-restart-button');
        const startButtonContainer = document.getElementById('start-button-container');
        const pauseMenu = document.getElementById('pause-menu');
        const gameControls = document.getElementById('game-controls');
        let scoreDisplay = document.getElementById('score'); // 从const改为let
        let timeDisplay = document.getElementById('time'); // 从const改为let
        let targetScoreDisplay = document.getElementById('target-score'); // 从const改为let
        const gameOverModal = document.getElementById('game-over-modal');
        const modalTitle = document.getElementById('modal-title');
        const finalScoreDisplay = document.getElementById('final-score');
        const resultMessageDisplay = document.getElementById('result-message');
        const playAgainButton = document.getElementById('play-again-button');

        // 游戏变量
        let score = 0;
        let timeLeft = GAME_TIME;
        let isGameRunning = false;
        let isPaused = false;
        let isCountingDown = false;
        let gameInterval;
        let targetInterval;
        let countdownInterval;
        let activeTargets = [];
        let gameInfoArea = null; // 游戏信息区域引用

        // 初始化游戏
        function initGame() {
            // 设置目标分数
            targetScoreDisplay.textContent = TARGET_SCORE;
            
            // 添加事件监听
            startButton.addEventListener('click', startGame);
            pauseButton.addEventListener('click', pauseGame);
            resumeButton.addEventListener('click', resumeGame);
            pauseRestartButton.addEventListener('click', restartGame);
            playAgainButton.addEventListener('click', playAgain);
        }

        // 开始游戏
        function startGame() {
            if (isGameRunning || isCountingDown) return;
            
            // 重置游戏状态
            score = 0;
            timeLeft = GAME_TIME;
            isPaused = false;
            
            // 移除所有动态生成的目标
            const targets = gameBoard.querySelectorAll('.target-item');
            targets.forEach(target => target.remove());
            
            // 隐藏倒计时元素（如果有）
            const countdownEl = gameBoard.querySelector('.countdown');
            if (countdownEl) countdownEl.remove();
            
            // 更新游戏信息显示
            let containerGameInfo = document.querySelector('.game-container > .game-info');
            
            // 如果没有找到游戏信息区域，则创建一个
            if (!containerGameInfo) {
                containerGameInfo = document.createElement('div');
                containerGameInfo.classList.add('game-info');
                containerGameInfo.innerHTML = `
                    <div class="score">得分: <span id="score">0</span></div>
                    <div class="time">时间: <span id="time">30</span>秒</div>
                    <div class="target">目标: <span id="target-score">20</span>分</div>
                `;
                const gameContainer = document.querySelector('.game-container');
                if (gameContainer) {
                    gameContainer.insertBefore(containerGameInfo, gameBoard);
                }
            } else {
                containerGameInfo.style.display = 'flex';
            }
            
            // 重新获取分数、时间和目标分数显示元素
            scoreDisplay = containerGameInfo.querySelector('#score');
            timeDisplay = containerGameInfo.querySelector('#time');
            targetScoreDisplay = containerGameInfo.querySelector('#target-score');
            
            if (scoreDisplay) scoreDisplay.textContent = score;
            if (timeDisplay) timeDisplay.textContent = timeLeft;
            if (targetScoreDisplay) targetScoreDisplay.textContent = TARGET_SCORE;
            
            // 设置游戏信息区域引用，供其他函数使用
            gameInfoArea = containerGameInfo;
            
            // 隐藏暂停菜单和游戏控制区域
            pauseMenu.classList.remove('active');
            gameControls.style.display = 'none';
            
            // 隐藏开始按钮容器
            if (startButtonContainer) {
                startButtonContainer.style.display = 'none';
            }
            
            // 开始倒计时
            startCountdown();
        }

        // 开始倒计时
        function startCountdown() {
            isCountingDown = true;
            let countdown = COUNTDOWN_TIME;
            
            // 创建倒计时元素
            const countdownEl = document.createElement('div');
            countdownEl.classList.add('countdown');
            countdownEl.textContent = countdown;
            gameBoard.appendChild(countdownEl);
            
            // 开始倒计时
            countdownInterval = setInterval(() => {
                countdown--;
                
                if (countdown > 0) {
                    countdownEl.textContent = countdown;
                } else {
                    // 倒计时结束
                    clearInterval(countdownInterval);
                    gameBoard.removeChild(countdownEl);
                    
                    // 隐藏开始按钮容器
                    if (startButtonContainer) {
                        startButtonContainer.style.display = 'none';
                    }
                    
                    // 显示游戏控制区域
                    gameControls.style.display = 'block';
                    
                    // 开始游戏
                    isGameRunning = true;
                    isCountingDown = false;
                    
                    // 启动计时器
                    gameInterval = setInterval(updateGame, 1000);
                    
                    // 开始随机出现目标
                    showRandomTarget();
                }
            }, 1000);
        }

        // 重新开始游戏
        function restartGame() {
            // 停止游戏
            stopGame();
            
            // 重新开始
            startGame();
        }

        // 游戏更新
        function updateGame() {
            if (isPaused) return;
            
            timeLeft--;
            timeDisplay.textContent = timeLeft;
            
            // 检查游戏是否结束
            if (timeLeft <= 0) {
                endGame();
            }
        }

        // 暂停游戏
        function pauseGame() {
            if (!isGameRunning || isPaused || isCountingDown) return;
            
            isPaused = true;
            
            // 显示暂停菜单
            pauseMenu.classList.add('active');
            
            // 隐藏游戏控制区域
            gameControls.style.display = 'none';
        }

        // 恢复游戏
        function resumeGame() {
            if (!isPaused) return;
            
            isPaused = false;
            
            // 隐藏暂停菜单
            pauseMenu.classList.remove('active');
            
            // 显示游戏控制区域
            gameControls.style.display = 'block';
            
            // 如果有活跃的目标，继续显示下一个目标
            if (isGameRunning) {
                showRandomTarget();
            }
        }

        // 显示随机目标
        function showRandomTarget() {
            if (!isGameRunning || isPaused) return;
            
            // 检查当前活跃目标数量是否超过限制
            if (activeTargets.length >= MAX_ACTIVE_TARGETS) {
                setTimeout(showRandomTarget, 100);
                return;
            }
            
            // 创建新的心形目标
            const heart = document.createElement('div');
            heart.classList.add('target-item', 'heart'); // 添加两个类名，确保与移除逻辑一致
            
            // 随机设置尺寸
            const size = Math.floor(Math.random() * (MAX_TARGET_SIZE - MIN_TARGET_SIZE + 1)) + MIN_TARGET_SIZE;
            heart.style.width = `${size}px`;
            heart.style.height = `${size}px`;
            
            // 获取游戏区域和信息区域的尺寸和位置
            const boardRect = gameBoard.getBoundingClientRect();
            const infoRect = gameInfoArea.getBoundingClientRect();
            const boardOffset = gameBoard.getBoundingClientRect().top + gameBoard.clientTop;
            
            // 计算可生成目标的区域（避开信息框体区域，确保不会溢出）
            let validPositionFound = false;
            let left, top;
            
            // 尝试最多10次寻找有效的位置
            for (let attempt = 0; attempt < 10; attempt++) {
                // 计算最大可放置位置（确保目标完全在游戏区域内且不在信息区域）
                const maxLeft = boardRect.width - size;
                const minTop = infoRect.height + 20; // 信息区域下方20px开始
                const maxTop = boardRect.height - size;
                
                // 生成随机位置
                left = Math.floor(Math.random() * maxLeft);
                top = Math.floor(Math.random() * (maxTop - minTop + 1)) + minTop;
                
                // 确保位置有效且不会溢出
                if (top >= minTop && left >= 0 && left <= maxLeft && top <= maxTop) {
                    validPositionFound = true;
                    break;
                }
            }
            
            // 如果找不到有效的位置，使用默认位置
            if (!validPositionFound) {
                left = Math.floor((boardRect.width - size) / 2);
                top = Math.floor(infoRect.height + 50); // 信息区域下方50px
            }
            
            heart.style.left = `${left}px`;
            heart.style.top = `${top}px`;
            
            // 添加点击事件
            heart.addEventListener('click', () => hitTarget(heart));
            
            // 添加到游戏区域
            gameBoard.appendChild(heart);
            activeTargets.push(heart);
            
            // 随机时间后隐藏目标
            const targetTime = Math.floor(Math.random() * (MAX_TARGET_TIME - MIN_TARGET_TIME + 1)) + MIN_TARGET_TIME;
            setTimeout(() => {
                hideTarget(heart);
            }, targetTime);
            
            // 随机时间后显示下一个目标（降低频率）
            const nextInterval = Math.floor(Math.random() * (MAX_INTERVAL - MIN_INTERVAL + 1)) + MIN_INTERVAL;
            targetInterval = setTimeout(showRandomTarget, nextInterval);
        }

        // 隐藏目标
        function hideTarget(target) {
            if (target && target.parentNode) {
                // 添加消失动画
                target.style.opacity = '0';
                target.style.transform = 'rotate(-45deg) scale(0.5)';
                
                // 动画结束后移除目标
                setTimeout(() => {
                    if (target && target.parentNode) {
                        gameBoard.removeChild(target);
                        // 从活跃目标列表中移除
                        const index = activeTargets.indexOf(target);
                        if (index > -1) {
                            activeTargets.splice(index, 1);
                        }
                    }
                }, 300);
            }
        }

        // 击中目标
        function hitTarget(target) {
            if (!isGameRunning || !target) return;
            
            // 获取目标位置用于加分提示
            const targetRect = target.getBoundingClientRect();
            const boardRect = gameBoard.getBoundingClientRect();
            const x = targetRect.left - boardRect.left + targetRect.width / 2;
            const y = targetRect.top - boardRect.top + targetRect.height / 2;
            
            // 添加击中效果
            target.classList.add('hit');
            
            // 增加分数
            score++;
            scoreDisplay.textContent = score;
            
            // 显示加分提示
            showScorePopup(x, y);
            
            // 隐藏目标
            setTimeout(() => {
                hideTarget(target);
            }, 200);
        }

        // 显示加分提示
        function showScorePopup(x, y) {
            const popup = document.createElement('div');
            popup.classList.add('score-popup');
            popup.textContent = '+1';
            popup.style.left = `${x}px`;
            popup.style.top = `${y}px`;
            popup.style.transform = 'translate(-50%, -50%)';
            
            gameBoard.appendChild(popup);
            
            // 动画结束后移除
            setTimeout(() => {
                if (popup.parentNode) {
                    gameBoard.removeChild(popup);
                }
            }, 1000);
        }

        // 结束游戏
        function endGame() {
            stopGame();
            
            // 显示游戏结束弹窗
            finalScoreDisplay.textContent = score;
            
            if (score >= TARGET_SCORE) {
                modalTitle.textContent = '恭喜你！';
                resultMessageDisplay.textContent = '你成功完成了目标！';
            } else {
                modalTitle.textContent = '游戏结束';
                resultMessageDisplay.textContent = '再接再厉，继续努力！';
            }
            
            gameOverModal.style.display = 'flex';
        }

        // 停止游戏
        function stopGame() {
            isGameRunning = false;
            isCountingDown = false;
            isPaused = false;
            
            // 清除计时器
            clearInterval(gameInterval);
            clearInterval(countdownInterval);
            clearTimeout(targetInterval);
            
            // 移除所有目标
            activeTargets.forEach(target => {
                hideTarget(target);
            });
            
            // 清空活跃目标列表
            activeTargets = [];
            
            // 隐藏游戏控制区域和暂停菜单
            gameControls.style.display = 'none';
            pauseMenu.classList.remove('active');
            
            // 显示开始按钮容器
            startButtonContainer.style.display = 'flex';
            
            // 更新按钮状态
            startButton.disabled = false;
        }

        // 再玩一次
        function playAgain() {
            // 隐藏弹窗
            gameOverModal.style.display = 'none';
            
            // 重新开始游戏
            startGame();
        }

        // 页面加载完成后初始化游戏
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>